variables:
  access_token: $(System.AccessToken)

jobs:
- job:
  displayName: 'Linux via curl'
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - script: |
      # Download the install script (python)
      install_script_url='https://vstscli.blob.core.windows.net/install/install.py'
      install_script_path=$(mktemp -t vsts_cli_install_tmp_XXXX)
      curl -# $install_script_url > $install_script_path
      
      # Run the install script
      # Note: since it prompts for install directory, etc (via stdin), we need to pass new lines for each
      echo $'\n\n\n' | python3 $install_script_path
            
      # Update $PATH with the install directory of the CLI
      echo '##vso[task.prependpath]~/lib/vsts-cli/bin'
    displayName: 'Install the VSTS CLI'

  - script: |
      vsts --version
      vsts login --instance $(System.TeamFoundationCollectionUri) --token $(access_token)
      vsts configure --defaults instance=$(System.TeamFoundationCollectionUri) 
      vsts configure --defaults project=vsts-cli-in-pipelines
      vsts build list
    displayName: 'Run the VSTS CLI'

- job:
  displayName: 'Windows via Chocolatey'
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - script: |
      choco install vsts-cli
      echo PATH: %PATH%
      refreshenv
      echo PATH: %PATH%
      vsts --version  
    displayName: 'Install VSTS CLI'
  - script: |
      vsts --version
      vsts login --instance $(System.TeamFoundationCollectionUri) --token $(access_token)
      vsts configure --defaults instance=$(System.TeamFoundationCollectionUri) 
      vsts configure --defaults project=vsts-cli-in-pipelines
      vsts build list

